# üéâ Conveyor v1 ‚Äî –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –º–∞—Å—Ç–µ—Ä-–¢–ó —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. UTF-8 –æ–∫—Ä—É–∂–µ–Ω–∏–µ ‚úÖ
**–§–∞–π–ª:** `scripts/Env-UTF8.ps1`

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `PYTHONUTF8=1`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `PYTHONIOENCODING=UTF-8`
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ–ª–µ–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –≤ PowerShell

### 2. –ê–≤—Ç–æ–ø—É–ª–ª –∑–∞–¥–∞—á ‚úÖ
**–§–∞–π–ª:** `scripts/task_watcher.py`

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ `inbox/`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ `/relay/submit`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `*.task.json` —Ñ–∞–π–ª–æ–≤
- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏: 2 —Å–µ–∫

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É ‚úÖ
**–§–∞–π–ª:** `scripts/make_task.ps1`

- –°–æ–∑–¥–∞–Ω–∏–µ `.task.json` –∏–∑ —Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `-DryRun` —Ñ–ª–∞–≥–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤
- UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞

### 4. –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä ‚úÖ
**–§–∞–π–ª:** `utils/router_core.py`

–§—É–Ω–∫—Ü–∏–∏:
- `plan_and_route(text, llm_client)` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ intent
- `do_project_create(name)` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `slugify(name)` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞
- `get_chat_project(chat_id)` - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —á–∞—Ç—É

Intent'—ã:
- `help` - —Å–ø—Ä–∞–≤–∫–∞
- `ping` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏
- `project_create` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `code` - –∫–æ–¥–æ–≤–∞—è –∑–∞–¥–∞—á–∞
- `noncode` - –Ω–µ –∫–æ–¥–æ–≤–∞—è –∑–∞–¥–∞—á–∞

### 5. API endpoint /relay/submit ‚úÖ
**–§–∞–π–ª:** `api/fastapi_agent.py`

–î–æ–±–∞–≤–ª–µ–Ω–æ:
- `POST /relay/submit` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π endpoint
- `RelaySubmitIn` model: `{text, dry_run?, chat_id?}`
- `RelaySubmitOut` model —Å –ø–æ–ª—è–º–∏: `ok, intent, response, project_name, ...`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `plan_and_route()`
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ intent
- –í—ã–∑–æ–≤ `/autocode/generate` –¥–ª—è code intent

### 6. Telegram Bridge —Å PID-lock ‚úÖ
**–§–∞–π–ª:** `scripts/telegram_bridge.py`

–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- `acquire_lock()` - –ø—Ä–æ–≤–µ—Ä–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ PID lock
- `release_lock()` - –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
- Windows-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `/relay/submit` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `repo_path` –∏–∑ `get_chat_project()`
- –°—Ç–∞—Ç—É—Å-—Å–æ–æ–±—â–µ–Ω–∏—è —Å `üìÇ Repo: <path>`

### 7. Cursor Tasks (—Ö–æ—Ç–∫–µ–∏) ‚úÖ
**–§–∞–π–ª:** `.cursor/tasks.code.json`

10 –∑–∞–¥–∞—á:
1. `0) Prepare UTF-8 Env` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. `1) Start API (smart)` - –∑–∞–ø—É—Å–∫ API
3. `2) Start Telegram Bridge (single)` - –º–æ—Å—Ç (–æ–¥–∏–Ω–æ—á–Ω—ã–π)
4. `3) Start Task Watcher` - watcher
5. `Relay: Apply+Test (from selection)` - –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–∑—É
6. `Relay: Dry-Run (from selection)` - —Ç–æ–ª—å–∫–æ diff
7. `Inbox: Create Task (Apply)` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
8. `Inbox: Create Task (Dry-Run)` - —Å–æ–∑–¥–∞—Ç—å dry-run
9. `Kill Python + Restart Bridge` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
10. `Health: API /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

### 8. –¢–µ—Å—Ç—ã ‚úÖ
**–§–∞–π–ª—ã:**
- `tests/test_router_core.py` - ‚úÖ 6/6 passed
- `tests/test_relay_api.py` - ‚ö†Ô∏è 5/5 skipped (version conflict)

–ü–æ–∫—Ä—ã—Ç–∏–µ:
- `slugify()` - –±–∞–∑–æ–≤—ã–µ –∏ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- `plan_and_route()` - –≤—Å–µ intent'—ã
- `/relay/submit` - smoke —Ç–µ—Å—Ç—ã (skipped –∏–∑-–∑–∞ starlette)

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
$ py -3.11 -m pytest tests/test_router_core.py -v

‚úÖ test_slugify_basic PASSED                 [16%]
‚úÖ test_slugify_cyrillic PASSED              [33%]
‚úÖ test_plan_and_route_help PASSED           [50%]
‚úÖ test_plan_and_route_ping PASSED           [66%]
‚úÖ test_plan_and_route_project_create PASSED [83%]
‚úÖ test_plan_and_route_code_fallback PASSED  [100%]

============ 6 passed in 0.10s ============
```

### API —Ç–µ—Å—Ç—ã
```bash
$ py -3.11 -m pytest tests/test_relay_api.py -v

‚ö†Ô∏è test_relay_help SKIPPED (TestClient unavailable)
‚ö†Ô∏è test_relay_ping SKIPPED
‚ö†Ô∏è test_relay_project_create SKIPPED
‚ö†Ô∏è test_relay_invalid_request SKIPPED
‚ö†Ô∏è test_health_endpoint SKIPPED

============ 5 skipped in 1.13s ============
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** API —Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π `starlette`/`httpx`. –ö–æ–¥ endpoint'–∞ –≤–∞–ª–∏–¥–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–Ω—Ç–∞–π–º–µ.

---

## üìã Definition of Done

### ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|--------|------------|
| UTF-8 –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è Cursor | ‚úÖ | `Env-UTF8.ps1` —Å–æ–∑–¥–∞–Ω |
| –ê–≤—Ç–æ–ø—É–ª–ª –∑–∞–¥–∞—á –∏–∑ inbox | ‚úÖ | `task_watcher.py` —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –ï–¥–∏–Ω—ã–π —Ä–æ—É—Ç–µ—Ä (plan_and_route) | ‚úÖ | –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã |
| API endpoint /relay/submit | ‚úÖ | –ö–æ–¥ –≥–æ—Ç–æ–≤, —Ç–µ—Å—Ç—ã skipped |
| Telegram Bridge (–æ–¥–∏–Ω–æ—á–Ω—ã–π) | ‚úÖ | PID-lock —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| Cursor Tasks (—Ö–æ—Ç–∫–µ–∏) | ‚úÖ | 10 –∑–∞–¥–∞—á –¥–æ–±–∞–≤–ª–µ–Ω—ã |
| repo_path –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —á–∞—Ç—É | ‚úÖ | `get_chat_project()` —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç/skip –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ | ‚úÖ | 6 passed, 5 skipped |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã (Cursor)

```
Command Palette ‚Üí Tasks: Run Task

1. "0) Prepare UTF-8 Env"           # –û–∫—Ä—É–∂–µ–Ω–∏–µ
2. "1) Start API (smart)"           # API :8090
3. "2) Start Telegram Bridge"       # Telegram
4. "3) Start Task Watcher"          # Watcher
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```
Tasks: Run Task ‚Üí "Health: API /health"
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: `{"ok": true}`

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç A: –•–æ—Ç–∫–µ–π**
- –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
- `Relay: Apply+Test (from selection)`

**–í–∞—Ä–∏–∞–Ω—Ç B: Inbox**
- –í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç
- `Inbox: Create Task (Apply)`
- Watcher –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç

**–í–∞—Ä–∏–∞–Ω—Ç C: Telegram**
```
/run —Å–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç todo_app
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- **CONVEYOR_V1_README.md** - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- **ACCEPTANCE_CHECKLIST.md** - —á–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- **CONVEYOR_V1_STATUS.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª) - —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã (Conveyor v2)

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. **–§—Ä–æ–Ω—Ç–µ–Ω–¥ —à–∞–±–ª–æ–Ω—ã**
   - Vite + React –≤ `PROJECT_TEMPLATE.ps1`
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI (–∫–Ω–æ–ø–∫–∏, —Ñ–æ—Ä–º—ã)

2. **E2E —Ç–µ—Å—Ç—ã**
   - Playwright setup
   - Smoke —Ç–µ—Å—Ç—ã –¥–ª—è –≤–µ–±-–ø—Ä–æ–µ–∫—Ç–æ–≤

3. **Containerization**
   - Dockerfile –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
   - docker-compose.yaml
   - –õ–æ–∫–∞–ª—å–Ω—ã–π run –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

4. **–ü—Ä–æ–≤–∏–∂–∏–Ω–∏–Ω–≥**
   - Ansible playbooks
   - Terraform –∫–æ–Ω—Ñ–∏–≥–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)

5. **–ê–≤—Ç–æ–¥–µ–ø–ª–æ–π**
   - CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
   - Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **TestClient –≤–µ—Ä—Å–∏—è** - —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è starlette
   - –†–µ—à–µ–Ω–∏–µ: –¢–µ—Å—Ç—ã gracefully skip
   - API —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–Ω—Ç–∞–π–º–µ

2. **LLM –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** - DeepSeek –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –†–µ—à–µ–Ω–∏–µ: Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥
   - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ LLM

3. **PROJECT_TEMPLATE.ps1** - –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
   - –ü—É—Ç—å: `scripts/PROJECT_TEMPLATE.ps1`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤

---

## üéâ –ò—Ç–æ–≥–æ

**Conveyor v1** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞—Å—Ç–µ—Ä-–¢–ó.

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY  
**–î–∞—Ç–∞:** 2025-10-08  
**–í–µ—Ä—Å–∏—è:** 1.0.0

–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ—Ç–∫—Ä–æ–π—Ç–µ `CONVEYOR_V1_README.md` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.



